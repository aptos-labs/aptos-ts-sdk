// Copyright Â© Aptos Foundation
// SPDX-License-Identifier: Apache-2.0

import {
  Account,
  Aptos,
  AccountAddress,
  UserTransactionResponse,
  GenerateFeePayerRawTransactionInput,
  GenerateMultiAgentRawTransactionInput,
  HexInput,
  SingleSignerTransaction,
  MultiAgentTransaction,
  FeePayerTransaction,
  GenerateTransactionPayloadData,
  TransactionFeePayerSignature,
  TransactionMultiAgentSignature,
} from "../../../src";
import { MoveVector } from "../../../src/bcs/serializable/moveStructs";
import { FUND_AMOUNT } from "../../unit/helper";

export async function publishModule(
  aptos: Aptos,
  senderAccount: Account,
  metadataBytes: HexInput,
  codeBytes: HexInput,
) {
  const rawTransaction = await aptos.generateTransaction({
    sender: senderAccount.accountAddress.toString(),
    data: {
      function: "0x1::code::publish_package_txn",
      functionArguments: [MoveVector.U8(metadataBytes), new MoveVector([MoveVector.U8(codeBytes)])],
    },
  });
  const signedTxn = await aptos.signTransaction({
    signer: senderAccount,
    transaction: rawTransaction,
  });
  const response = await aptos.submitTransaction({
    transaction: rawTransaction,
    senderAuthenticator: signedTxn,
  });
  return (await aptos.waitForTransaction({ transactionHash: response.hash })) as UserTransactionResponse;
}

export async function fundAccounts(aptos: Aptos, accounts: Array<Account>) {
  // eslint-disable-next-line no-restricted-syntax
  for (const account of accounts) {
    // eslint-disable-next-line no-await-in-loop
    await aptos.fundAccount({ accountAddress: account.accountAddress.toString(), amount: FUND_AMOUNT });
  }
}

// Transaction builder helpers
// single signer
export async function signAndSubmitSingleSignerHelper(
  aptos: Aptos,
  rawTransaction: SingleSignerTransaction,
  senderAccount: Account,
): Promise<UserTransactionResponse> {
  const rawTransaction = await aptos.generateTransaction({
    sender: senderAccount.accountAddress.toString(),
    data: {
      function: `${senderAccount.accountAddress.toString()}::tx_args_module::${functionName}`,
      typeArguments: typeArgs,
      functionArguments: args,
    },
  });
  const senderAuthenticator = await aptos.signTransaction({
    signer: senderAccount,
    transaction: rawTransaction,
  });
  const transactionResponse = await aptos.submitTransaction({
    transaction: rawTransaction,
    senderAuthenticator,
  });
  const response = await aptos.waitForTransaction({
    transactionHash: transactionResponse.hash,
  });
  return response as UserTransactionResponse;
}
// multi agent/fee payer
export const generateMultiAgentHelper = async (
  aptos: Aptos,
  payload: GenerateTransactionPayloadData,
  senderAccount: Account,
  secondarySignerAccounts: Array<Account>,
  feePayerAccount?: Account,
): Promise<FeePayerTransaction | MultiAgentTransaction> => {
  // TODO: Combine these to one type later. This should be possible but isn't right now due to typescript
  // compile time errors because it can't resolve the types
  const transactionData = {
    sender: senderAccount.accountAddress.toString(),
    data: {
      function: `${senderAccount.accountAddress.toString()}::tx_args_module::${functionName}`,
      typeArguments: typeArgs,
      functionArguments: args,
    },
  };
  let generatedTx;
  if (secondarySignerAccounts.length === 0) {
    generatedTx = await aptos.generateTransaction({
      ...transactionData,
      feePayerAddress: feePayerAccount?.accountAddress.data,
    } as GenerateFeePayerRawTransactionInput);
  } else if (feePayerAccount === undefined) {
    generatedTx = await aptos.generateTransaction({
      ...transactionData,
      secondarySignerAddresses: secondarySignerAccounts.map((account) => account.accountAddress.data),
    } as GenerateMultiAgentRawTransactionInput);
  } else {
    generatedTx = await aptos.generateTransaction({
      ...transactionData,
      secondarySignerAddresses: secondarySignerAccounts.map((account) => account.accountAddress.data),
      feePayerAddress: feePayerAccount?.accountAddress.data,
    } as GenerateFeePayerRawTransactionInput);
  }
  return generatedTx;
};

// multi agent/fee payer
export const signAndSubmitMultiAgentHelper = async (
  aptos: Aptos,
  generatedTransaction: FeePayerTransaction | MultiAgentTransaction,
  senderAccount: Account,
  secondarySignerAccounts: Array<Account>,
  feePayerAccount?: Account,
): Promise<UserTransactionResponse> => {
  const senderAuthenticator = aptos.signTransaction({
    signer: senderAccount,
    transaction: generatedTransaction,
  });

  const secondaryAuthenticators = secondarySignerAccounts.map((account) =>
    aptos.signTransaction({
      signer: account,
      transaction: generatedTransaction,
    }),
  );

  let feePayerAuthenticator;
  if (feePayerAccount !== undefined) {
    feePayerAuthenticator = aptos.signTransaction({
      signer: feePayerAccount,
      transaction: generatedTransaction,
    });
  }

  const transactionResponse = await aptos.submitTransaction({
    transaction: generatedTransaction,
    senderAuthenticator,
    secondarySignerAuthenticators: {
      additionalSignersAuthenticators: secondaryAuthenticators,
      feePayerAuthenticator,
    },
  });
  const response = await aptos.waitForTransaction({ transactionHash: transactionResponse.hash });
  return response as UserTransactionResponse;
};

export async function buildAndTestAnyMultiAgentFunction(
  aptos: Aptos,
  senderAccount: Account,
  payload: GenerateTransactionPayloadData,
  expectedSignatureType: string,
  secondarySignerAccounts: Array<Account>,
  feePayerAccount?: Account,
): Promise<UserTransactionResponse> {
  const secondarySignerAddresses = secondarySignerAccounts.map((a) => a.accountAddress);
  const generated = await generateMultiAgentHelper(
    aptos,
    payload,
    senderAccount,
    secondarySignerAccounts,
    feePayerAccount,
  );
  const response = await signAndSubmitMultiAgentHelper(
    aptos,
    generated,
    senderAccount,
    secondarySignerAccounts,
    feePayerAccount,
  );
  expect(response.success).toBe(true);
  const responseSignature = response.signature as TransactionFeePayerSignature | TransactionMultiAgentSignature;
  expect(responseSignature.type).toEqual(expectedSignatureType);
  const secondarySignerAddressesParsed = responseSignature.secondary_signer_addresses.map((address) =>
    AccountAddress.fromStringRelaxed(address),
  );
  expect(secondarySignerAddressesParsed.map((s) => s.toString())).toEqual(
    secondarySignerAddresses.map((address) => address.toString()),
  );
  if (feePayerAccount) {
    expect(
      AccountAddress.fromStringRelaxed(
        (responseSignature as TransactionFeePayerSignature).fee_payer_address,
      ).toString(),
    ).toEqual(feePayerAccount.accountAddress.toString());
  }
  return response;
}

const ACCOUNT_PUBLISH_PAYLOAD_GENERATED_WITH = "0a56e8b03118e51cf88140e5e18d1f764e0a1048c23e7c56bd01bd5b76993451";

// script function byte code from `arguments/sources/script.move` for the transaction_arguments.test.ts script function tests
export const singleSignerScriptArgumentTest =
  // eslint-disable-next-line max-len
  "a11ceb0b060000000601000802080e03160a05202d074d6408b1014000000001000201030204070000050701000103060800010702030003080401000d060c0501020d0e03040f0508000b010108020a020001060c01050b01020d0e03040f0508000b010108020a02066f626a656374067369676e657206737472696e670e74785f617267735f6d6f64756c6506537472696e67064f626a6563740d456d7074795265736f757263650a616464726573735f6f66186173736572745f76616c7565735f666f725f73637269707400000000000000000000000000000000000000000000000000000000000000010a56e8b03118e51cf88140e5e18d1f764e0a1048c23e7c56bd01bd5b76993451000001150b0011000b012104060508066400000000000000270b020b030b040b050b060b070b080b090b0a0b0b0b0c110102";
export const multiSignerScriptArgumentTest =
  // eslint-disable-next-line max-len
  "a11ceb0b060000000601000802080e03160a05203907596408bd0140000000010002010302040700000507010001030608000107020300030804010015060c060c060c060c060c050505050501020d0e03040f0508000b010108020a020001060c01050b01020d0e03040f0508000b010108020a02066f626a656374067369676e657206737472696e670e74785f617267735f6d6f64756c6506537472696e67064f626a6563740d456d7074795265736f757263650a616464726573735f6f66186173736572745f76616c7565735f666f725f73637269707400000000000000000000000000000000000000000000000000000000000000010a56e8b03118e51cf88140e5e18d1f764e0a1048c23e7c56bd01bd5b76993451000001490b0011000b0521040605100b04010b03010b02010b0101066400000000000000270b0111000b06210416051e0b04010b03010b0201066500000000000000270b0211000b07210424052a0b04010b0301066600000000000000270b0311000b0821043005340b0401066700000000000000270b0411000b0921043a053c066800000000000000270b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b14110102";

export function interpolateAddressIntoScriptBytecode(scriptBytecode: string, deploymentAddress: AccountAddress) {
  let oldString = scriptBytecode;
  let newString = scriptBytecode.replace(
    ACCOUNT_PUBLISH_PAYLOAD_GENERATED_WITH,
    deploymentAddress.toStringWithoutPrefix(),
  );
  while (oldString !== newString) {
    oldString = newString;
    newString = newString.replace(ACCOUNT_PUBLISH_PAYLOAD_GENERATED_WITH, deploymentAddress.toStringWithoutPrefix());
  }
  return newString;
}

// hard-coded bytecode for the contract so we don't have to recompile it every time in ci
export const ARGUMENT_TESTS_CONTRACT_METADATA =
  // eslint-disable-next-line max-len
  "0x25417267756d656e7420546573747320666f722074686520547970657363726970742053444b0100000000000000004043413231383446464441323142414333343346373339354341363546343732443541353643304438364337344544353145323645444646413138384135323930f2011f8b08000000000002ffa5903f4fc33010c5777f0acb7bd25662ed5009b13030902daaa2abf35c421a9f659b00427c77ec24441dba55f67277effdee4fed48f774c651581a20f7521dfcf963808db24288411af632be4156df0e41fbce45f9faf8acc4081f3ab6d9b12dd35342d42d1c6c0bab3b84a338b8c8e1c927ec27fb3e097fe485355db2a52c37eba7ac2b347b14bb251878c4c6fc5b97e41a2bf93bc32bee615f4eefd069d0bbf931d30a9e71b987a8a96d3d42c8db4c9ac65cada3b65f3bb5e4276fc3eb28a9f6a044f46403e998eed4d072d6a9daccd71a8bab0637c5fb043a01469381fa0357683d82ac010000010e74785f617267735f6d6f64756c65f51d1f8b08000000000002ffed5c6d6fe33612fede5fc1eb01a98dd36d2deac52fd92c9add18db00d9642f718a16412028369de8ea58ae256737d7ee7f3f8e244a24454af4ee02ed1d142491440e9fa1869ce17048f1315eec5604a5db709d84f3348ad741b8bddf3d92759a4c26e947784a82c79ceaf76f10fdd9250425e9623249d26db4be3f1413c9761b6fa5b424ba5f1339f189ccd31a65bc812a4c26bf5f91d5d24217d9e32799e8eedfb46c45943dca4479e526932b5525d3e70d09a2f5322e4068e18ce0fbefbf47b30782f2baa11559dfa70f090ab704ade31491df76e1ea4546398fd7498a4ecfdf5c5c5e4edfcc829fe8bf8bcbe06c7afe76f6e304ed7c171d217b30381470a3359503437f0a573bd2005e40fe747c763dbd0ace2f66c1f45fd7c7670c1cf3e0b9a0908da28482ad090ad70b968869e2fabb9487be783f3bbd38cff14e67bf04d3cb4bca69c0a01d1d74123f7e1eb4cda05d25342d9a86d19a0a032da2e5926c69f7cbe583d287705db26b678419230f1871e4af8fafa605cd9b8b9369f0fefaf5d9e99be0f8f2edf5bbe9f9ec8a6b33564575c177d767b3d3e0eaf4edf9f4926b0ba1ccc9f4fdd9c52fd34b4a7c350bde1dcfdefc18bcbb38b93e9b06c7272797d3ab92dd90fe1c5261a0c1cf36f16dbec6ef8e7f0eae479470041c3cef50ceb37d9a69fb34d7f73ca79eef80301c0c52c76377ec0ff1b84ee4bbc1ebd3b7e5db8f5cd71fbaee60e80c0763cfb37d5bc1178f8a32f40eba8b3bc023ecf8fe180fc6cec8f51dfaeb0c5d7f30741d7be88fb06dbb8afa63cf2f70e81d30b7bd2185188db1337428e7b1e762c7a3f518d1c61cf9a3e178301c790ef6c763cac4f77c77007fced8f586de88f6ace1d8766c3cf69df118c4c1f19bfefc9e6ad3f424787d714135e82e8e579461badd9143155529765b9d5d491eab092ad13b6a02df2d3542c3028f4a017b6a122ab55276be92a4ec6ce162b1254942097f509a7a65e9abd9e5e9396d9edc5ebddc8d5ed1f277df928f1b9a4016416e62bf550bbab05eb9bc0b04103b60088f375933586819ae127a810774cb6c04557f8296f16a157fa0aca8fd4cc93db5a060bf9322bd20d93e86e984951a58c8b610b6a09fa17f56377676d3505d6878e175b9879b0a167b0efc73e19fc76aab4184bec2506c9fc784270e1494d8c92f6e7e6983865ec6c01ccc43c313075deabfc3ddbbdc7d1b27e8ae0cdb77794ef0c4715218104799ea2a535b8589b906a20f8238b1d8486666c93125744d09dbde21535b5669fac0bf43f6c88bf36b9a44e72be3b95f19af4570a5312b8455d8344e7c65ca0dfa61f0910a91fe0fefe6d9754196d9d5c64e76753d3fbb0e47e366b69215ac0c02c7984fbc5198488ba6d18a64575a91ec4a2b925d6945b22badc8b75093ac2ab4dc6e9ea22b92ee3627611aa2873041bf92e7c205871ff2b8499f83dc1706ff2a77835f4e21f99224f16e3b27af2c3539de8fdc6924ff245459a0a8aacda896bb35b5e2515a4c297a0bb259c5cf643b4107f92ca1cfbd629824649bfead97e74c2645fb06f1b22cd74747ba31cd3270c3fa8725b31549117ddfa46a55e53b4303df8aa5225a6450257d7888e88b45e82572f89761d4592f0351c5db604b96b42c9bcfccb7244c4921f49efaa5b80a73950e72097158f7843e035a9ed33b90d84a388ff11309d2b82724c2cf41856ed532c5b6fefd9348a1ae2a57c7a2772db7f1632055afadbe790b4d269b5df210dc85f35f7b078fbbbcfd2cf82f91430b45e81fcc9dcb7a6d75cbc0b6e4896c13524149bd23016d0c16a08e479c6a8a4d2cab6559d3782355b46fe90be2cf2de8181664335e6de3330513795522a8d20b29150abed9ddada239a27d75fb9c697b36d74ec3fbe4e58c5ae4191dd76674609b512b3ca303c8cca37fd412cf86f46f44ffc640931102a50da4e041ccc06198d9406d03b90df43614b0a104861238c3861260e367184a602881a1048612184ae0f1ab9ecacc086fca8508b2db7849eb0fe5a8bd51e465be2ccd3d386845b1f528740031c3c00d18d4ad3403711a401c6c08e23680f8ae2188d7f43ad854287e030a38566628433d0af32fcc80467aa03c28658833d6e3a84728c36ed8d09bf9099a299cdd0a07ee9121186e07a3dddc14cd6947a3fddd14cd6d47a31ddf14cd3378536c2e38bf1d0e54c1146ed80ac7742247a438eda0a356d0423f4c6b396e05542b8aa9b16dd0943c32b997a660bb15ce5c53306e0733d714ecb4a3996b0a76dbd1cc35057b066f6aae29d86f87db4353f0b0154ed49476c4512be27e6a82c7ad805a3511bdc081a9ef972754b397cac50ac2f93cdead3317f9409e5f50fa00342a0fd48ae9bb2c342ba515f15829b508c24aa945e4554660e15629bd8cb18ae9455b96815531b7587b4279fb8879c5e4a76dfe9ddbad20f3edf990648d2297133f60d74876a346849d14a1ac134871c63a81141e54b090e37675925a58ac46520a5d1a7a6a844cfee2685223634dd1384654a5f2b549d62495a5ae51e44dc28f0c351268920684ac4938f35d278026e12c729d009a8433b20a1698ab83d8248c246b12de18d648ca26916c5c8d90358968b96a64a57634d9a3aa140df52f089da83e076b9240bccdae5a3347503e31bb497f2cc0985d9c5ce831b10653bc08638621b2b30fb2c636d759f55138ff6d17d176500629209251c627f380cc3d49836a66dfebbf10831887b5993233d0309a084b6b56eb3a2b8dc20cfa6a4458713be217e18cd06c1d1aaccf1d098b764678588707cb7947c21a9f119ea3c383d5bf236149d008cfd5be2f96e407a39909a2a743cc96168fc4154723445f83582e431ed5d6288d70871adcdcba002cdbf6b14b97a39eb492d937e231d2f0c8b50178f0da630439ae4106b96e2741b6eba3c78ff6163756dfdc9aa9c0c09041e64e29d768cdf8d8867ca883a6585a35e3814d79803e2b565bcdb838a65c40cb150baf665c5c532ea0fb8a4557332e9eb1c4b0aa5d4ccd84ed9bf2c9cc846addd38ccfd0900ff3bd752b8566dc4686dc72cb62658365690184bc9e9981b14dcd416e71728e29f5188a84a4a036648715c621f7b6183bdeb1b510db8207dbc8f280b4191bdb904d6e831817d851d6135c084376d8901d982235b3eb51df32e1e4987202dba3614575c7ecb55c5366608234cc1c6cf6629e292f30441a5ebe6bc6cb371622d63718cd3314e3d0945d669434ec689e21bb9121bbd262a939b2456933a66343a6cc70093c1bfd24b30a38a68685d931a102bc1365c8cf16a34d74cef3265c7f97a23b82e6e16a4516089692518892f936daa468133eafe27091117331a96df4040be38aa0541793ea62525d4caa8b497d764caa25f4a20f870bd6c72a8d8d5598178b99148b59118b190eabb41556691d2cde1e589cfa5b9cba5b8a0d35e20cb4a80237a7e3a75efc04899fc608930d614620bbed92632d7abd42ed541eaae048726e1eef87f16e12efc6086e86e004c843b4347ad66ab7e70248f0b85ba5d166c5f665990e3e451e6ec8731af2dc863c4f91973f33599026f3d68d8bddb8d88d8bddb8f825e362b6b9523239c106a6140bba4eaddadf2d6e4aac6f0f2e8da9b472dd408acd491d7352d79cd4e3486f5b2244b2b4ac06f9598d9fb0f5b98da09d7ff27fee9f34cc823bcfa4f34c3acfa4f34c3acfa469c6de6025e5219219c6ead6a96eddead6ab8fdddd00fb3f1e0088d6ab684db28156e5bebd9c4dd0621b6f5ec14a1fb76769f62a1302b7e30852a0c5a2f5827ccc461cd5872bec8b9ffcbc0a5aa877900167bb3d3599d4dd45d9591d9349b47e0a57117cac483d829ee64c0b1a802f2bd2efd73f9efa4fb47939b3d0ac78a7e2452cf44768a1bb3fa48fa4ca7d1550c13b4d4594ec3e19ca5b588880972e9acf2ead0288b648c442a25eded112f5d822469404d90a29c89361f7fb9af76c28a46d07cd191dba76f884c82a21edfc61f1e50bf8db3afe6c1e4756042c257ce65730bd8b29fc075150878dd564c7815495b418ee7eb5c55a69490b4917ebd533823576384d004e89c95790e0f01bb48dee1f52b48e3fbc40ef624a1153926d76e24082e2252ac70638c90596a392dd66136fe9d2d60bbe8bf2b6203bf8255882e9cbf8f43a9fd5c8ddfc737736eeb16d71af3d897b6d38dc6b37e19e5b05f7dc07f8599bfcbe7807dfbedbf3c65fb865addc5b57188bbfdf3c45e4c3adacda9018d04568e5b272a7d4dd44b49b887613d1c689e804551643b413bc7d10cc82600d042320aabea4f0b28ecb7a6da4cb2add532bac9252a5994a6d546aa05ae9d47aa6d52b9d22b56a8eaaa7abd5a381521480b2ef2bfbbbba8bab7bb5b617ebbaad51c0a472b8a4e0078b59d452f90ecc0d728a44be4373439caa3856810a1d5d1addea1989d4f1c541ad213ea2caa9bf7ae5592893650170f11465ba2c063ecea2cca809438abfa8f25422318dcba872ea52a9e235ca64592a5c1c47992e4b858fef28336a5291e23eaa3c955474f1200367b1690bb93ccc73eac6422d8fe1a6a73ea58a865b1239d622f8d3499f8ba4f035e52228f29c89aec2a8665bf9b43eb85fc57734c25252bcd21d5c6428177ea33bf0eea94723b44fb2c9f2337fb68f2c81438dc5ab68a479a5654486cdc81c4de7929a4cf985408b372809a157d61f955564774ebf108cd84087668327ba414dd8e876ffde5185cbb36e5205bba51b83c6ffa2f716bb8474b6555107491cbd03c650da1db05f69fc45a5f94d0c9272c2ab9627ac1de94e572b562df0119cb2573e3af078573ebaf0382f1f3d785c58681e6f09dcdafddbf258b84cc03085a60f19336e0a5d3b26aeb6228cf5598e3ecbd567a9569fa1da52724bf72a8f9c5e9230dd512af148b122957631960f47b75131eca285d0cbaaecf943b8be274191102c57e17dd2838ab105949b22ebb64cb8e53779005b26ce2a56839aced83b54edd4c1cd851995bab06354d85117768d0abbeac29e51618f9798eabc42f36d33ea83d4c4d8a23aeb7aa4cb909d242146a8c9911d2531f8a7c9aa394bb5889eded7a8c5ee04d296c8acca032dbe8855d787ff96b591422b55ee13d26602ad8cb90f375b58e0b64ae8052f7de35813aaf6dbc41aa5fa9b4285932b7c0ca8cc577dc66740089fe09990c1e77326740e36a3f35d43bed8b082d9a7620684e5175e7ada962fb3f4055b34aa2fac5957c64bff395467bd3aebd559afce7afdf5ac17bbfddc7d5a9ac36d0b975599ea28535d65aaa7d47fee7472d9ffb66a4eb555f394ad9afb6bd57c5a0bdd7686ba33d49da1ee0cf55fddcdec2c7467a13b0bdd59e8ce42ffb9161a2e34f0ffe99bff02fc1ea80c0a72000000000400000000000000000000000000000000000000000000000000000000000000010e4170746f734672616d65776f726b00000000000000000000000000000000000000000000000000000000000000010b4170746f735374646c696200000000000000000000000000000000000000000000000000000000000000010a4d6f76655374646c69620000000000000000000000000000000000000000000000000000000000000004114170746f73546f6b656e4f626a6563747300";

export const ARGUMENT_TESTS_CONTRACT_BYTECODE =
  // eslint-disable-next-line max-len
  "0xa11ceb0b060000000c0100100210200330aa0104da01f80105d2039d0807ef0bd10408c01040068011aa0710aa1882020aac1a1a0cc61af7270dbd4206000001010102010301040105010601070008080000090800050a0700020b0701000103110701000002200200062b0700000c000100000d010200000e010300000f01040000100501000012060100001307010000140601000015070100001601011e0000000000000000000000000000000000000000000000000000000000000017080800051c0a0b00011d0d0d00071e0e010100021f111201080421051200022212160002231718000224171901080325012001000326211b01000327211b01000328212201000329231b0100032a24200100062c012701000d0c0d0a0e1012100d150d1b0d1c0d1d0d0d0d1e0d1f0d120d0b130c140c150c160c170c181b141b151b161b171b180c181c141c151c161c171c181d141d151d161d171d180d140d150d160d170d181e141e151e161e171e181f141f151f161f171f18121412151216121712180b140b150b160b170b181514151515161517151924191b1928190c1929191c192a191d192b190d192c191e192d191f192e1912192f190b19301915193119321933190a193419351936193719381939193a193b193c193d193e193f19401902194119421943194419451946194719481949194a194b194c194d194e194f19501951195219531954195519560b01020d0e03040f0508020b030108000a0200010a080203050505030b030108000b030108000b0301080001060c21060c01020d0e03040f0508020b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b0301080026060c060c060c060c060c0a0501020d0e03040f0508020b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b030108002001020d0e03040f0508020b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b0301080009030b03010800030a020a020a020a020a020a02010a020108020102010301070a090007070a08020a02030a08020a020a0a020a0a0201080001060b03010900010501060801060805030b030108000c0a0b030108000801010b0301080001080501060805010c010b0301090089010a0b0301080003030303030303030303030303030303030303030303060206010602060d060e06030604060f0605060802060b030108000b0301080003030303030303030303030b030108000b030108000b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b030108000a020a020a010a010a020a020a0d0a0d0a0e0a0e0a030a030a040a040a0f0a0f0a050a050a08020a08020a0b030108000a0b030108000a020a020a010a010a020a020a0d0a0d0a0e0a0e0a030a030a040a040a0f0a0f0a050a050a08020a08020a0b030108000a0b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000101010d010e0104010f010b0401090001060b040109000106090002060b040109000609000109000903030a050a050a050a050a050a050a051d010101010101010101010101010101010101010101010101010101010101080601090101090201090301090401090501090601090701090801090901090a010a0101090b01090c010a0d01090d010a0e01090e010a0301090f010a04010910010a0f010911010a05010912010913010a0b03010800010914010b040101010915010b040102010916010b04010d010917010b04010e010918010b040103010919010b04010401091a010b04010f01091b010b04010501091c010b0401080201091d010b04010b030108000e74785f617267735f6d6f64756c65056572726f72066f626a656374066f7074696f6e067369676e657206737472696e6709747970655f696e666f06766563746f720d456d7074795265736f757263650953657475704461746106537472696e67064f626a656374186173736572745f76616c7565735f666f725f7363726970741a6765745f65787065637465645f766563746f725f737472696e67196765745f746573745f6f626a6563745f616464726573736573106765745f746573745f6f626a656374730b696e69745f6d6f64756c65064f7074696f6e11707269766174655f617267756d656e747322707269766174655f617267756d656e74735f6d756c7469706c655f7369676e657273107075626c69635f617267756d656e7473217075626c69635f617267756d656e74735f6d756c7469706c655f7369676e65727309747970655f7461677312766965775f616c6c5f617267756d656e74730b64756d6d795f6669656c640e656d7074795f6f626a6563745f310e656d7074795f6f626a6563745f320e656d7074795f6f626a6563745f3304757466380d696e76616c69645f737461746507726576657273650e6f626a6563745f616464726573730e436f6e7374727563746f725265660a616464726573735f6f660d6372656174655f6f626a6563740f67656e65726174655f7369676e65721b6f626a6563745f66726f6d5f636f6e7374727563746f725f726566046e6f6e650769735f6e6f6e650769735f736f6d6506626f72726f7708636f6e7461696e7304736f6d650854797065496e666f07747970655f6f660a56e8b03118e51cf88140e5e18d1f764e0a1048c23e7c56bd01bd5b7699345100000000000000000000000000000000000000000000000000000000000000010308d007000000000000030810270000000000000308611e00000000000005200a56e8b03118e51cf88140e5e18d1f764e0a1048c23e7c56bd01bd5b769934510101010a02100f65787065637465645f737472696e670410050000000000000000000000000000000d0202000f2006000000000000000000000000000000000000000000000000000000000000000e0403000000030804000000000000000201010a05c1010600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000abc0000000000000000000000000000000000000000000000000000000000000def0000000000000000000000000000000000000000000000000000000000000123000000000000000000000000000000000000000000000000000000000000045600000000000000000000000000000000000000000000000000000000000007890a0104030100010a0a0225060f65787065637465645f737472696e6703616263036465660331323303343536033738390a046106000000000000000000000000000000000100000000000000000000000000000002000000000000000000000000000000fdfffffffffffffffffffffffffffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0a0d0d06000001000200fdfffeffffff0a0fc10106000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000fdfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0a0e1906000000000100000002000000fdfffffffeffffffffffffff0a033106000000000000000001000000000000000200000000000000fdfffffffffffffffeffffffffffffffffffffffffffffff0a020706000102fdfeff030864000000000000000410ffffffffffffffffffffffffffffffff0d02ffff0f20ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0e04ffffffff0308ffffffffffffffff0201ff03082c01000000000000030890010000000000000308f4010000000000000308c8000000000000000a020100126170746f733a3a6d657461646174615f7631ed010601000000000000000b45585045435445445f55380002000000000000000c45585045435445445f5531360003000000000000000c45585045435445445f5533320004000000000000000c45585045435445445f5536340005000000000000000d45585045435445445f553132380006000000000000000d45585045435445445f55323536000004106765745f746573745f6f626a6563747301010012766965775f616c6c5f617267756d656e7473010100196765745f746573745f6f626a6563745f6164647265737365730101001a6765745f65787065637465645f766563746f725f737472696e670101000002011801010203190b030108001a0b030108001b0b030108000001000101098e0107032b011000140c0c0b00070421040a050c060000000000000000270b01070b2104110513060100000000000000270b020707210418051a060200000000000000270b03070921041f0521060300000000000000270b04070a2104260528060400000000000000270b05070621042d052f060500000000000000270b0607082104340536060600000000000000270b07070321043b053d060700000000000000270b080705110b2104430545060800000000000000270b090b0c21044a054c060900000000000000270b0a0714060a000000000000000c0b0c130c120e12410c0e13410c210459055e07150b0b16110c270b120b130c100c0e0d0e38000d1038000b0e0b100c110c0f0e0f410c0c0d0a0d0e11410c2104730575060200020000000000270a0d06000000000000000024048901057a0d0f450c0d11450c210481010584010b0b110c270b0d060100000000000000170c0d05750b0f460c00000000000000000b11460c000000000000000002010100000f24400b00000000000000000c03070e0c050d0538010b050c060e06410a0c020a0206000000000000000024042005100d06450a0c010d030c000b010c040b000b04110b440b0b02060100000000000000170c02050b0b06460a00000000000000000b03020201000101040b11030c020c010c000e0038020e0138020e023802020301000101130d07032b010c000a001000140a001001140b00100214020400000014360a00110f0703210406050a0b0001070227401500000000000000000c050600000000000000000c020a020603000000000000002304280513070311100c010e0111110c040e040912002d000e0138030c030d050b0344150b02060100000000000000160c02050e0d0538040d0545150d0545150d05451512010c060b000b062d0102050004010101230b000b010b020b030b040b050b060b070b080b090b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b140b150b160b170b180b190b1a0b1b0b1c0b1d0b1e0b1f0b20110702060004010101280b000b010b020b030b040b050b060b070b080b090b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b140b150b160b170b180b190b1a0b1b0b1c0b1d0b1e0b1f0b200b210b220b230b240b2511080207010401011aaf0a07032b011000140c430b01070421040a050e070106000000000000000016270b02070b2104130517070106010000000000000016270b03070721041c0520070106020000000000000016270b0407092104250529070106030000000000000016270b05070a21042e0532070106040000000000000016270b060706210437053b070106050000000000000016270b0707082104400544070106060000000000000016270b080703210449054d070106070000000000000016270b090705110b2104530557070106080000000000000016270b0a0a4321045c0560070106090000000000000016270b0b07200701060a00000000000000160c220c9f010c94010e9401410c0e9f01410c21046f057407150b2216110c270b94010b9f010c7e0c680d6838000d7e38000b680b7e0c7f0c690e69410c0c440a440e7f410c21048901058b01060200020000000000270a4406000000000000000024049f010590010d69450c0d7f450c21049701059a010b22110c270b44060100000000000000170c44058b010b69460c00000000000000000b7f460c00000000000000000b0c070d0701060b00000000000000160c230ca0010c95010e9501411b0ea001411b2104b20105b70107150b2316110c270b95010ba0010c80010c6a0d6a38050d800138050b6a0b80010c81010c6b0e6b411b0c450a450e8101411b2104cc0105ce01060200020000000000270a450600000000000000002404e20105d3010d6b451b0d8101451b2104da0105dd010b23110c270b45060100000000000000170c4505ce010b6b461b00000000000000000b8101461b00000000000000000b0d07140701060c00000000000000160c240ca1010c96010e9601410c0ea101410c2104f50105fa0107150b2416110c270b96010ba1010c82010c6c0d6c38000d820138000b6c0b82010c83010c6d0e6d410c0c460a460e8301410c21048f02059102060200020000000000270a460600000000000000002404a5020596020d6d450c0d8301450c21049d0205a0020b24110c270b46060100000000000000170c460591020b6d460c00000000000000000b8301460c00000000000000000b0e07100701060d00000000000000160c250ca2010c97010e9701411c0ea201411c2104b80205bd0207150b2516110c270b97010ba2010c84010c6e0d6e38060d840138060b6e0b84010c85010c6f0e6f411c0c470a470e8501411c2104d20205d402060200020000000000270a470600000000000000002404e80205d9020d6f451c0d8501451c2104e00205e3020b25110c270b47060100000000000000170c4705d4020b6f461c00000000000000000b8501461c00000000000000000b0f07120701060e00000000000000160c260ca3010c98010e9801411d0ea301411d2104fb0205800307150b2616110c270b98010ba3010c86010c700d7038070d860138070b700b86010c87010c710e71411d0c480a480e8701411d21049503059703060200020000000000270a480600000000000000002404ab03059c030d71451d0d8701451d2104a30305a6030b26110c270b48060100000000000000170c480597030b71461d00000000000000000b8701461d00000000000000000b1007130701060f00000000000000160c270ca4010c99010e9901410d0ea401410d2104be0305c30307150b2716110c270b99010ba4010c88010c720d7238080d880138080b720b88010c89010c730e73410d0c490a490e8901410d2104d80305da03060200020000000000270a490600000000000000002404ee0305df030d73450d0d8901450d2104e60305e9030b27110c270b49060100000000000000170c4905da030b73460d00000000000000000b8901460d00000000000000000b11070f0701061000000000000000160c280ca5010c9a010e9a01411e0ea501411e2104810405860407150b2816110c270b9a010ba5010c8a010c740d7438090d8a0138090b740b8a010c8b010c750e75411e0c4a0a4a0e8b01411e21049b04059d04060200020000000000270a4a0600000000000000002404b10405a2040d75451e0d8b01451e2104a90405ac040b28110c270b4a060100000000000000170c4a059d040b75461e00000000000000000b8b01461e00000000000000000b1207110701061100000000000000160c290ca6010c9b010e9b01411f0ea601411f2104c40405c90407150b2916110c270b9b010ba6010c8c010c760d76380a0d8c01380a0b760b8c010c8d010c770e77411f0c4b0a4b0e8d01411f2104de0405e004060200020000000000270a4b0600000000000000002404f40405e5040d77451f0d8d01451f2104ec0405ef040b29110c270b4b060100000000000000170c4b05e0040b77461f00000000000000000b8d01461f00000000000000000b13070c0701061200000000000000160c2a0ca7010c9c010e9c0141120ea701411221048705058c0507150b2a16110c270b9c010ba7010c8e010c780d78380b0d8e01380b0b780b8e010c8f010c790e7941120c4c0a4c0e8f0141122104a10505a305060200020000000000270a4c0600000000000000002404b70505a8050d7945120d8f0145122104af0505b2050b2a110c270b4c060100000000000000170c4c05a3050b79461200000000000000000b8f01461200000000000000000b1411010701061300000000000000160c2b0ca8010c9d010e9d01410b0ea801410b2104ca0505cf0507150b2b16110c270b9d010ba8010c90010c7a0d7a380c0d9001380c0b7a0b90010c91010c7b0e7b410b0c4d0a4d0e9101410b2104e40505e605060200020000000000270a4d0600000000000000002404fa0505eb050d7b450b0d9101450b2104f20505f5050b2b110c270b4d060100000000000000170c4d05e6050b7b460b00000000000000000b9101460b00000000000000000b150c2111030c510c500c4f0b210b4f0b500b51401503000000000000000701061400000000000000160c2c0ca9010c9e010e9e0141150ea901411521049606059b0607150b2c16110c270b9e010ba9010c92010c7c0d7c38040d920138040b7c0b92010c93010c7d0e7d41150c4e0a4e0e930141152104b00605b206060200020000000000270a4e0600000000000000002404c60605b7060d7d45150d930145152104be0605c1060b2c110c270b4e060100000000000000170c4e05b2060b7d461500000000000000000b9301461500000000000000000b16380d0701061500000000000000160c2d0c5d0c520e52380e04df060e5d380e04d90605de06071c0b2d16110c2705f5060e5d380f04e30605e806071d0b2d16110c270e5238100c380e5d0b38381104f00605f506071e0b2d16110c270b17070438120701061600000000000000160c2e0c5e0c530e533813048b070e5e3813048507058a07071c0b2e16110c2705a1070e5e3814048f07059407071d0b2e16110c270e5338150c390e5e0b393816049c0705a107071e0b2e16110c270b18070b38170701061700000000000000160c2f0c5f0c540e54380e04b7070e5f380e04b10705b607071c0b2f16110c2705cd070e5f380f04bb0705c007071d0b2f16110c270e5438100c3a0e5f0b3a381104c80705cd07071e0b2f16110c270b19070738180701061800000000000000160c300c600c550e55381904e3070e60381904dd0705e207071c0b3016110c2705f9070e60381a04e70705ec07071d0b3016110c270e55381b0c3b0e600b3b381c04f40705f907071e0b3016110c270b1a0709381d0701061900000000000000160c310c610c560e56381e048f080e61381e048908058e08071c0b3116110c2705a5080e61381f049308059808071d0b3116110c270e5638200c3c0e610b3c382104a00805a508071e0b3116110c270b1b070a38220701061a00000000000000160c320c620c570e57382304bb080e62382304b50805ba08071c0b3216110c2705d1080e62382404bf0805c408071d0b3216110c270e5738250c3d0e620b3d382604cc0805d108071e0b3216110c270b1c070638270701061b00000000000000160c330c630c580e58382804e7080e63382804e10805e608071c0b3316110c2705fd080e63382904eb0805f008071d0b3316110c270e58382a0c3e0e630b3e382b04f80805fd08071e0b3316110c270b1d0708382c0701061c00000000000000160c340c640c590e59382d0493090e64382d048d09059209071c0b3416110c2705a9090e64382e049709059c09071d0b3416110c270e59382f0c3f0e640b3f383004a40905a909071e0b3416110c270b1e070338310701061d00000000000000160c350c650c5a0e5a383204bf090e65383204b90905be09071c0b3516110c2705d5090e65383304c30905c809071d0b3516110c270e5a38340c400e650b40383504d00905d509071e0b3516110c270b1f0705110b38360701061e00000000000000160c360c660c5b0e5b383704ec090e66383704e60905eb09071c0b3616110c2705820a0e66383804f00905f509071d0b3616110c270e5b38390c410e660b41383a04fd0905820a071e0b3616110c270b200b43383b0701061f00000000000000160c370c670c5c0e5c383c04980a0e67383c04920a05970a071c0b3716110c2705ae0a0e67383d049c0a05a10a071d0b3716110c270e5c383e0c420e670b42383f04a90a05ae0a071e0b3716110c2702080104010125760a00110f0b01110f0b02110f0b03110f0b04110f401205000000000000000c280b050b2807000c260c2e0c2d0e2d41120e2e411221041905200b000107150b2616110c270b2d0b2e0c2b0c290d29380b0d2b380b0b290b2b0c2c0c2a0e2a41120c270a270e2c411221043505390b0001060200020000000000270a2706000000000000000024044f053e0d2a45120d2c4512210445054a0b00010b26110c270b27060100000000000000170c2705390b2a461200000000000000000b2c461200000000000000000b000b060b070b080b090b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b140b150b160b170b180b190b1a0b1b0b1c0b1d0b1e0b1f0b200b210b220b230b240b2511070209010400268d023840384121040938423843210c00050b090c000b00041238443845210c0b0514090c0b0b0b041b38463847210c16051d090c160b16042438483849210c170526090c170b17042d384a384b210c18052f090c180b180436384c384d210c190538090c190b19043f384e384f210c1a0541090c1a0b1a044838503851210c1b054a090c1b0b1b045138523853210c1c0553090c1c0b1c045a38543855210c01055c090c010b01046338563857210c020565090c020b02046c38583859210c03056e090c030b030475385a385b210c040577090c040b04047e385c385d210c05058001090c050b05048701385e385f210c06058901090c060b0604900138603861210c07059201090c070b0704990138623863210c08059b01090c080b0804a20138643865210c0905a401090c090b0904ab0138663867210c0a05ad01090c0a0b0a04b40138683869210c0c05b601090c0c0b0c04bd01386a386b210c0d05bf01090c0d0b0d04c601386c386d210c0e05c801090c0e0b0e04cf01386e386f210c0f05d101090c0f0b0f04d80138703871210c1005da01090c100b1004e10138723873210c1105e301090c110b1104ea0138743875210c1205ec01090c120b1204f30138763877210c1305f501090c130b1304fc0138783879210c1405fe01090c140b14048502387a387b210c15058702090c150b15048a02058c0206000000000000000027020a01000001210b000b010b020b030b040b050b060b070b080b090b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b140b150b160b170b180b190b1a0b1b0b1c0b1d0b1e0b1f0201000101010200";

// interpolate a named address into the contract bytecode
export function getArgumentsTestContractBytecode(deploymentAddress: AccountAddress) {
  let oldString = ARGUMENT_TESTS_CONTRACT_BYTECODE;
  let newString = ARGUMENT_TESTS_CONTRACT_BYTECODE.replace(
    ACCOUNT_PUBLISH_PAYLOAD_GENERATED_WITH,
    deploymentAddress.toStringWithoutPrefix(),
  );
  // replaceAll
  // replaces the address used to generate the publish payload with the CLI, this one being `0a56...3451`
  while (oldString !== newString) {
    oldString = newString;
    newString = newString.replace(ACCOUNT_PUBLISH_PAYLOAD_GENERATED_WITH, deploymentAddress.toStringWithoutPrefix());
  }
  return newString;
}

export async function publishArgumentTestModule(
  aptos: Aptos,
  publisherAccount: Account,
): Promise<UserTransactionResponse> {
  const contractBytecode = await getArgumentsTestContractBytecode(publisherAccount.accountAddress);
  const response = await publishModule(aptos, publisherAccount, ARGUMENT_TESTS_CONTRACT_METADATA, contractBytecode);
  return response;
}

export const singleSignerScriptBytecode =
  // eslint-disable-next-line max-len
  "a11ceb0b060000000701000402040a030e0c041a04051e20073e30086e2000000001010204010001000308000104030401000105050601000002010203060c0305010b0001080101080102060c03010b0001090002050b00010900000a6170746f735f636f696e04636f696e04436f696e094170746f73436f696e087769746864726177076465706f7369740000000000000000000000000000000000000000000000000000000000000001000001080b000b0138000c030b020b03380102";

export const multiSignerScriptBytecode =
  // eslint-disable-next-line max-len
  "a11ceb0b060000000701000402040a030e18042608052e4307713e08af01200000000101020401000100030800010403040100010505060100010607040100010708060100000201020202030207060c060c0303050503030b000108010b000108010b0001080101080102060c03010b0001090002070b000109000b000109000002070b000109000302050b000109000a6170746f735f636f696e04636f696e04436f696e094170746f73436f696e087769746864726177056d657267650765787472616374076465706f73697400000000000000000000000000000000000000000000000000000000000000010000011a0b000a0238000c070b010a0338000c080d070b0838010d070b020b03160b061738020c090b040b0738030b050b09380302";

export async function publishTransferPackage(aptos: Aptos, senderAccount: Account) {
  await publishModule(
    aptos,
    senderAccount,
    // eslint-disable-next-line max-len
    "107472616e73616374696f6e5f746573740100000000000000004035364643333939394442364244363842383430304539323438363839393837413338313439344644413241343631334144373946333630323134353539324545ba011f8b08000000000002ff5d8f3d0ec2300c85779f0265e944032b12030b97a8aaca4d4c1b95fc284e0bc72729a503f2e2a7f7d97e6e02aa09076ac1a1a5c3f5205244c7a892f1ae4bc449c04291b32ae6a9ce25001a4d819c26a70c717d0bc9f33de6052f1fa7160693325c8d2905be4899e538f7b5f25662218f4fec796b958f5467a082484b19b2685c053cf7dac4a2bf98f50bc9c7efc236bbeb2a0742ad233113b7b0baddeeaeb9df6701ff9f15a3131fec1509190201000001087472616e73666572ca021f8b08000000000002ff9552cb4ec33010bcf72bf654a522dc10071790101f12b9f1a6582476e407a142fd77fc48d23826125891627b661fb39e4e32db22184585a6b5e1525406b52124dc34a8e07b07e03eab11686fa4ae1a453b1ca4fa20245ed4928be33629c03b87f6f6d4f21a50187581c60a3083ac4e97cafd0a07c7d570e5cac35ef3b34055cef71a6b29d82f00eda415a61ae3ece343064da109c6f41c431953a8758a4d413988bdd43c2f780893f2ab45035e74a4c07338103270f3ce141d9e6e5323e4d5efdfdcf6a508ec32d17338ae53c6b6fe9c33d2cb741287f01a7e457e87ea8cc5beb3cbb6cb65bd5bc45623f8e50c539b3ccb520edca58dc07d3acd75632358cc6f552e52cfb3c9b993ea5481e75e6381dc89a3db8b85df0443b5e9b7959b14d61c3f3d3ff14bee897fbc9caf3fcd6f43ec54364a9d355e7f00fb8d2dcfd603000000000300000000000000000000000000000000000000000000000000000000000000010e4170746f734672616d65776f726b00000000000000000000000000000000000000000000000000000000000000010b4170746f735374646c696200000000000000000000000000000000000000000000000000000000000000010a4d6f76655374646c696200",
    // eslint-disable-next-line max-len
    `a11ceb0b060000000801000602060a031022043208053a4e0788015208da01400c9a024c000001010102020404010001010508000000000100000302010002060506010002070701010002080901010002090a060100020403040404050403060c03050007060c060c0303050503010b0001080101080102060c03010b0001090002050b00010900030b000108010b000108010b0001080102070b000109000b0001090002070b0001090003087472616e736665720a6170746f735f636f696e04636f696e0a74776f5f62795f74776f04436f696e094170746f73436f696e087769746864726177076465706f736974056d657267650765787472616374${senderAccount.accountAddress.toStringWithoutPrefix()}00000000000000000000000000000000000000000000000000000000000000010001040003080b000b0138000c030b020b0338010201010400081a0b000a0238000c070b010a0338000c080d070b0838020d070b020b03160b061738030c090b040b0738010b050b0938010200`,
  );
}
